# Задание: Контейнеризация CRM приложения

## Описание проекта
Веб-приложение для управления базой клиентов, состоящее из трех компонентов:
- Frontend (React + TypeScript)
- Backend (Node.js + Express)
- Database (PostgreSQL)

## Цель задания
Необходимо полностью контейнеризировать приложение с использованием Docker и Docker Compose.

## Требования к выполнению

### 1. Dockerfile для каждого компонента
Создать оптимизированные Dockerfile для всех компонентов системы:

#### Backend (backend/Dockerfile)
- Использовать multi-stage build для оптимизации размера образа
- Использовать Alpine для минимизации размера
- Запускать приложение от непривилегированного пользователя
- Правильно настроить рабочую директорию и копирование файлов
- Использовать кеширование слоев Docker для ускорения сборки

#### Frontend (frontend/Dockerfile)
- Использовать multi-stage build (deps, builder, runner)
- Этап сборки с Node.js для компиляции React приложения
- Финальный образ на базе nginx:alpine для раздачи статики
- Настроить проксирование API запросов к backend
- Оптимизировать размер финального образа

#### Database (database/Dockerfile)
- Базовый образ PostgreSQL Alpine
- Автоматическая инициализация базы данных через init.sql
- Настройка прав доступа для скриптов инициализации

### 2. Docker Compose конфигурация
Файл docker-compose.yml должен содержать:

#### Сервисы
- **database**: PostgreSQL контейнер с инициализацией БД
- **backend**: Node.js API сервер
- **frontend**: Nginx сервер для React приложения

#### Сетевая архитектура
- **backend_network**: изолированная сеть для связи backend с database
- **frontend_network**: сеть для связи frontend с backend
- Frontend не должен иметь прямого доступа к database
- Backend должен иметь доступ к обеим сетям

#### Volumes
- Именованный volume для PostgreSQL данных (postgres_data)
- Обеспечение персистентности данных БД между перезапусками

#### Переменные окружения
- Все чувствительные данные вынесены в .env файл
- Поддержка переопределения портов через переменные
- Конфигурация подключения к БД через переменные окружения

#### Health checks
- Проверка готовности PostgreSQL перед запуском backend
- Правильная последовательность запуска сервисов (depends_on)

### 3. Файл переменных окружения (.env)
Должен содержать:
- Параметры подключения к БД (пользователь, пароль, имя БД)
- Порты для всех сервисов
- Режим работы приложения (NODE_ENV)

### 4. Дополнительные требования
- Создать .dockerignore для исключения ненужных файлов из контекста сборки
- Обновить backend/server.js для использования переменных окружения
- Все контейнеры должны автоматически перезапускаться при сбое

## Проверка выполнения

### Запуск приложения
Приложение должно полностью запускаться одной командой:
```bash
docker-compose up --build
```

### Доступность сервисов
После запуска должны быть доступны:
- Frontend: http://localhost (порт 80 по умолчанию)
- Backend API: http://localhost:3001
- PostgreSQL: localhost:5432 (для отладки)

### Функциональность
1. Открыть веб-интерфейс в браузере
2. Проверить отображение списка клиентов
3. Добавить нового клиента через форму
4. Убедиться, что данные сохраняются в БД
5. Перезапустить контейнеры и проверить сохранность данных

### Изоляция сетей
- Frontend контейнер не должен иметь возможности подключиться к database напрямую
- Backend должен успешно подключаться к database
- Frontend должен проксировать API запросы к backend

## Критерии оценки
1. **Корректность работы** - приложение запускается и работает без ошибок
2. **Best Practices** - использование multi-stage builds, непривилегированных пользователей, оптимизация размера образов
3. **Безопасность** - правильная изоляция сетей, использование переменных окружения для секретов
4. **Оптимизация** - эффективное использование кеша Docker, минимальный размер образов
5. **Документация** - наличие комментариев в конфигурационных файлах

## Формат сдачи работы
Архив с проектом или ссылку на git репозиторий, где будут:
- Все исходные файлы приложения
- Dockerfile для каждого компонента
- docker-compose.yml
- .env файл с переменными окружения
- .dockerignore
- Этот файл TASK.md с описанием задания

## Дополнительные задания (опционально)
- Настроить SSL/TLS для frontend (самоподписанный сертификат)
- Добавить контейнер для резервного копирования БД
- Настроить логирование в отдельные volumes